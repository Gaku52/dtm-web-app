# 要件定義書: DTM Web App

**作成日**: 2025-11-06
**バージョン**: 1.0.0

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
DTM Web App - Web-based Music Composition Application

### 1.2 コア価値
**「ブラウザだけで、誰でも、今すぐ音楽を作れる」**

### 1.3 目的
ブラウザ上で動作する、初心者から中級者向けのDTM作曲アプリケーション。ピアノロール形式で音符を入力し、複数トラックで楽曲を制作できる。作成した楽曲は保存・共有でき、MIDIファイルとしてエクスポート可能。

### 1.4 背景
従来のDAWソフトウェアはインストールが必要で初心者には敷居が高い。Web上で手軽に音楽制作を始められ、デバイスを問わずアクセスできるアプリケーションの需要がある。

---

## 2. コア機能（MVP）

### 2.1 コア機能（1つ）
- **ピアノロールエディタ**
  - マウス/タッチで音符を配置・編集
  - リアルタイムで音が鳴る
  - 視覚的に音楽を構築できる

### 2.2 必須サポート機能（3つ）
1. **トラック管理**
   - 複数トラックの追加/削除
   - トラックごとに楽器を選択
   - トラックのミュート/ソロ機能

2. **再生コントロール**
   - 再生/停止/一時停止
   - テンポ設定（BPM）
   - ループ再生

3. **プロジェクト保存/読込**
   - Supabaseに保存
   - プロジェクト一覧表示
   - 自動保存機能

### 2.3 Nice-to-have（v2以降）
- **MIDIファイルエクスポート**
  - 作成した楽曲をMIDI形式でダウンロード
  - DAWソフトへの連携

### 2.4 実装しない機能
- ❌ オーディオファイルのインポート - 理由: MVPではMIDIベースに集中
- ❌ エフェクター機能 - 理由: 複雑さを避け、作曲に集中
- ❌ プラグイン対応 - 理由: スコープが大きすぎる
- ❌ 楽譜表示 - 理由: ピアノロールに集中

---

## 3. 対象ユーザー

1. **音楽制作初心者**
   - DAWを使ったことがない人
   - 音楽理論の知識が少ない人

2. **趣味で作曲をする人**
   - 手軽に曲のアイデアをメモしたい
   - 移動中やカフェでも作曲したい

3. **モバイルデバイスでも音楽制作をしたい人**
   - タブレットやスマートフォンでも利用可能

4. **DAWソフトのインストール不要で手軽に作曲したい人**
   - ブラウザだけで完結したい

---

## 4. 機能要件詳細

### 4.1 ピアノロールエディタ

**基本機能:**
- グリッド表示（16分音符単位）
- 音符の配置（クリック/タップ）
- 音符の長さ調整（ドラッグ）
- 音符の削除（右クリック/長押し）
- 音符の選択/移動/複製
- 音域表示（C0〜C8）
- スナップ機能（グリッドに吸着）

**表示機能:**
- 拡大/縮小（水平・垂直）
- スクロール（マウスホイール/タッチ）
- 現在の再生位置表示
- 小節番号表示

### 4.2 トラック管理

**トラック機能:**
- トラック追加/削除（最大8トラック）
- トラック名変更
- トラックの色設定
- 音量調整（0-100%）
- パン調整（L-R）
- ミュート/ソロボタン

**楽器選択:**
- ピアノ
- ギター
- ベース
- ドラム
- シンセサイザー
- ストリングス
- ブラス
- その他（8種類程度）

### 4.3 再生コントロール

**基本コントロール:**
- 再生ボタン
- 停止ボタン
- 一時停止ボタン
- 巻き戻し/早送り
- ループ再生設定

**設定:**
- テンポ設定（40-240 BPM）
- 拍子設定（4/4, 3/4, 6/8など）
- キー設定（C major, A minorなど）

### 4.4 プロジェクト管理

**保存機能:**
- プロジェクト名設定
- Supabaseへの保存
- 自動保存（3分ごと）
- 保存履歴（最新10件）

**読込機能:**
- プロジェクト一覧表示
- サムネイル表示（トラック数、長さなど）
- 検索/フィルター
- 削除機能

**認証:**
- Supabase認証
- メールアドレス + パスワード
- ソーシャルログイン（Google, GitHub）

---

## 5. 技術要件

### 5.1 技術スタック

**フロントエンド:**
- Next.js 15 (App Router)
- TypeScript
- Tailwind CSS
- shadcn/ui
- Framer Motion

**音声処理:**
- Web Audio API
- Tone.js（音楽制作ライブラリ）

**バックエンド:**
- Supabase
  - Authentication
  - PostgreSQL Database
  - Storage

**デプロイ:**
- Vercel

### 5.2 データベース設計

**projects テーブル:**
```sql
- id: uuid (PK)
- user_id: uuid (FK)
- name: text
- tempo: integer
- time_signature: text
- key: text
- created_at: timestamp
- updated_at: timestamp
```

**tracks テーブル:**
```sql
- id: uuid (PK)
- project_id: uuid (FK)
- name: text
- instrument: text
- color: text
- volume: integer
- pan: integer
- muted: boolean
- solo: boolean
- order: integer
```

**notes テーブル:**
```sql
- id: uuid (PK)
- track_id: uuid (FK)
- pitch: integer (MIDI note number)
- start_time: float (in beats)
- duration: float (in beats)
- velocity: integer (0-127)
```

---

## 6. UI/UX要件

### 6.1 デザインシステム

**カラーパレット:**
- Primary: Blue (#3B82F6)
- Secondary: Purple (#8B5CF6)
- Success: Green (#10B981)
- Warning: Yellow (#F59E0B)
- Error: Red (#EF4444)
- Background: Dark Gray (#1F2937)
- Surface: Lighter Gray (#374151)
- Text: White (#FFFFFF)

**タイポグラフィ:**
- Font Family: Inter
- Heading: 24px, 20px, 18px
- Body: 14px, 16px
- Caption: 12px

**スペーシング:**
- 基本単位: 8px
- Small: 4px, 8px
- Medium: 16px, 24px
- Large: 32px, 48px

### 6.2 レイアウト

**画面構成:**
```
┌─────────────────────────────────────┐
│ Header (Logo, Project Name, Save)  │
├─────────────────────────────────────┤
│ Toolbar (Play, Stop, Tempo, etc.)  │
├─────────────────────────────────────┤
│ ┌─────┬─────────────────────────┐ │
│ │Track│  Piano Roll Editor      │ │
│ │List │  (Main Canvas)          │ │
│ │     │                         │ │
│ │     │                         │ │
│ └─────┴─────────────────────────┘ │
└─────────────────────────────────────┘
```

### 6.3 レスポンシブ対応

**ブレークポイント:**
- Mobile: < 640px
- Tablet: 640px - 1024px
- Desktop: > 1024px

**モバイル対応:**
- タッチ操作最適化
- 縦スクロール対応
- 簡略化されたUI

---

## 7. 非機能要件

### 7.1 パフォーマンス
- 初回ロード: 3秒以内
- 音符配置のレスポンス: 50ms以内
- 再生開始: 100ms以内

### 7.2 セキュリティ
- HTTPS必須
- Supabase Row Level Security (RLS)
- XSS対策
- CSRF対策

### 7.3 可用性
- 稼働率: 99.9%以上
- オフライン対応（将来的に）

### 7.4 ブラウザ対応
- Chrome (最新版)
- Firefox (最新版)
- Safari (最新版)
- Edge (最新版)

---

## 8. 開発フェーズ

### Phase 1: 基礎実装 (2週間)
- [ ] プロジェクトセットアップ
- [ ] Supabase連携
- [ ] 認証機能
- [ ] 基本的なUI構築

### Phase 2: コア機能実装 (4週間)
- [ ] ピアノロールエディタ
- [ ] 音符の配置/編集
- [ ] Web Audio API統合
- [ ] トラック管理

### Phase 3: 再生機能 (2週間)
- [ ] 再生/停止機能
- [ ] テンポ/拍子設定
- [ ] 音源読み込み

### Phase 4: データ永続化 (1週間)
- [ ] プロジェクト保存/読込
- [ ] 自動保存
- [ ] プロジェクト一覧

### Phase 5: テスト&リリース (1週間)
- [ ] E2Eテスト
- [ ] パフォーマンス最適化
- [ ] デプロイ

---

## 9. 成功基準

### 9.1 定量的指標
- 月間アクティブユーザー: 1,000人以上
- プロジェクト作成数: 500件以上
- 平均セッション時間: 10分以上

### 9.2 定性的指標
- 「使いやすい」評価: 80%以上
- 「またログインしたい」: 70%以上
- NPS (Net Promoter Score): 50以上

---

## 10. 今後の拡張機能（v2以降）

- MIDIファイルエクスポート/インポート
- エフェクター（リバーブ、ディレイなど）
- オーディオ録音機能
- コラボレーション機能
- 楽曲共有/公開
- コミュニティ機能
- プラグイン対応

---

## 付録: 技術調査メモ

### Web Audio API
- AudioContext
- OscillatorNode
- GainNode

### Tone.js
- Transport（タイムライン管理）
- Sampler（音源）
- Sequence（パターン再生）

### Canvas / SVG
- ピアノロールの描画
- パフォーマンス考慮

---

**このドキュメントは開発の進捗に応じて更新されます。**
