# 音源データ戦略ドキュメント

**作成日**: 2025-11-06
**重要度**: ★★★★★（最重要）

DTMアプリの品質を決定する最も重要な要素が音源データです。このドキュメントでは、音源データの実装方式、取得方法、配置戦略を詳細に比較検討します。

---

## 目次

1. [音源の実装方式](#1-音源の実装方式)
2. [音源データの取得方法](#2-音源データの取得方法)
3. [データ配置戦略](#3-データ配置戦略)
4. [ファイル形式と最適化](#4-ファイル形式と最適化)
5. [推奨案](#5-推奨案)
6. [具体的な実装ロードマップ](#6-具体的な実装ロードマップ)

---

## 1. 音源の実装方式

### 方式A: Web Audio API Oscillator（シンセサイザー方式）

**概要:**
ブラウザのWeb Audio APIを使って、リアルタイムで音を生成する方式。

```javascript
// 実装例
const audioContext = new AudioContext();
const oscillator = audioContext.createOscillator();
oscillator.type = 'sine'; // sine, square, sawtooth, triangle
oscillator.frequency.value = 440; // A4
oscillator.start();
```

**メリット:**
- ✅ **完全無料**: 外部データ不要
- ✅ **ファイルサイズゼロ**: ダウンロード不要
- ✅ **実装が簡単**: Web Audio APIの基本機能
- ✅ **レイテンシが低い**: リアルタイム生成

**デメリット:**
- ❌ **音質が単調**: シンプルな波形のみ
- ❌ **リアルな楽器音は困難**: サンプルベースに劣る
- ❌ **表現力が限定的**: 生楽器の再現は不可能

**適用範囲:**
- シンセサイザー系の音色
- 電子音楽向け
- プロトタイプやデモ

**コスト:** 0円
**難易度:** ★☆☆☆☆（簡単）
**音質:** ★★☆☆☆

---

### 方式B: サンプル音源（オーディオファイル）

**概要:**
実際の楽器を録音したオーディオファイル（MP3, WAV, OGG）を再生する方式。

```javascript
// 実装例（Tone.js使用）
const sampler = new Tone.Sampler({
  urls: {
    C3: "piano-C3.mp3",
    C4: "piano-C4.mp3",
    C5: "piano-C5.mp3",
  },
  baseUrl: "/sounds/piano/",
}).toDestination();

sampler.triggerAttackRelease("C4", "4n");
```

**メリット:**
- ✅ **高音質**: リアルな楽器音を再現
- ✅ **表現力が高い**: ベロシティ、アーティキュレーション対応
- ✅ **多様な音色**: あらゆる楽器に対応可能
- ✅ **実装が明確**: Tone.jsで簡単

**デメリット:**
- ❌ **ファイルサイズが大きい**: 10-100MB程度
- ❌ **初回ロードが遅い**: ダウンロード時間がかかる
- ❌ **音源の調達が必要**: 録音 or ライセンス取得

**適用範囲:**
- リアルな楽器音（ピアノ、ギター、ドラムなど）
- 高品質なDTMアプリ

**コスト:** 0円〜数万円（音源による）
**難易度:** ★★★☆☆（中程度）
**音質:** ★★★★★

---

### 方式C: SoundFont形式（.sf2）

**概要:**
MIDI音源の標準フォーマットであるSoundFontファイルを使用。

```javascript
// 実装例（sf2-synth.js使用）
const soundFont = await fetch('/soundfonts/piano.sf2');
const synth = new SF2Synth(soundFont);
synth.noteOn(60, 100); // C4
```

**メリット:**
- ✅ **ファイルサイズが小さい**: 圧縮効率が高い（1-20MB）
- ✅ **音質が良い**: サンプルベース
- ✅ **無料音源が豊富**: フリーSoundFontが多数存在
- ✅ **標準フォーマット**: MIDI互換性が高い

**デメリット:**
- ❌ **ライブラリの選択が限定的**: JavaScriptライブラリが少ない
- ❌ **実装が複雑**: パーサーが必要
- ❌ **ブラウザ互換性の問題**: 一部ブラウザで制限

**適用範囲:**
- MIDI互換性を重視する場合
- ファイルサイズを抑えたい場合

**コスト:** 0円（フリーSoundFont使用）
**難易度:** ★★★★☆（やや難しい）
**音質:** ★★★★☆

---

### 方式D: ハイブリッド方式（推奨）

**概要:**
シンセサイザー音源とサンプル音源を併用。

**構成:**
- **シンセ系音色**: Web Audio API Oscillator
  - シンセリード、シンセパッド、ベース
- **リアル系音色**: サンプル音源
  - ピアノ、ギター、ドラム、ストリングス

**メリット:**
- ✅ **最適なバランス**: 音質とファイルサイズの両立
- ✅ **段階的実装**: MVPはシンセのみ、後でサンプル追加
- ✅ **柔軟性**: 用途に応じて使い分け

**デメリット:**
- ❌ **実装が複雑**: 2つのシステムを管理

**コスト:** 0円〜数千円
**難易度:** ★★★☆☆
**音質:** ★★★★☆

---

## 2. 音源データの取得方法

### 方法1: フリー音源ライブラリの利用（推奨）

#### オプション1-A: Freesound.org
- **URL**: https://freesound.org/
- **ライセンス**: Creative Commons
- **音質**: ★★★☆☆〜★★★★☆
- **種類**: 50万以上のサウンド
- **コスト**: 無料
- **注意点**: 個別にライセンス確認が必要（CC0, CC BY, CC BY-NCなど）

#### オプション1-B: Philharmonia Orchestra（推奨）
- **URL**: https://philharmonia.co.uk/resources/sound-samples/
- **ライセンス**: CC BY-SA 3.0
- **音質**: ★★★★★（プロオーケストラ録音）
- **種類**: オーケストラ楽器のみ
- **コスト**: 無料
- **推奨度**: 高品質、商用利用可

#### オプション1-C: University of Iowa Electronic Music Studios
- **URL**: http://theremin.music.uiowa.edu/MIS.html
- **ライセンス**: 教育・非商用利用
- **音質**: ★★★★☆
- **種類**: 多様な楽器
- **コスト**: 無料
- **注意点**: 商用利用は要確認

#### オプション1-D: Versilian Studios Chamber Orchestra (VSCO)
- **URL**: https://github.com/sgossner/VSCO-2-CE
- **ライセンス**: CC0 1.0（パブリックドメイン）
- **音質**: ★★★★☆
- **種類**: オーケストラ音源
- **コスト**: 無料
- **推奨度**: ライセンスが自由、商用利用可

---

### 方法2: 既存のオープンソース音源

#### オプション2-A: GeneralUser GS SoundFont
- **URL**: https://schristiancollins.com/generaluser.php
- **ライセンス**: フリー（商用利用可）
- **形式**: SoundFont (.sf2)
- **サイズ**: 30MB
- **音質**: ★★★★☆
- **推奨度**: 高品質、手軽

#### オプション2-B: FluidR3_GM SoundFont
- **URL**: https://github.com/musescore/MuseScore/tree/master/share/sound
- **ライセンス**: MIT License
- **形式**: SoundFont (.sf2)
- **サイズ**: 140MB
- **音質**: ★★★★☆

---

### 方法3: 有料音源ライブラリ

#### オプション3-A: Splice Sounds
- **URL**: https://splice.com/sounds
- **ライセンス**: ロイヤリティフリー
- **音質**: ★★★★★
- **コスト**: $9.99/月〜
- **推奨度**: プロ品質だが、コストがかかる

#### オプション3-B: Loopmasters
- **URL**: https://www.loopmasters.com/
- **ライセンス**: ロイヤリティフリー
- **音質**: ★★★★★
- **コスト**: $20〜$200/パック

---

### 方法4: 自作録音

**メリット:**
- ✅ ライセンスの心配なし
- ✅ 独自性

**デメリット:**
- ❌ 録音機材が必要
- ❌ 音質の確保が困難
- ❌ 時間とコストがかかる

**コスト:** 数千円〜数十万円（機材）
**推奨度:** MVPには不向き

---

## 3. データ配置戦略

### 戦略A: 完全リポジトリ内配置

**構成:**
```
public/
└── sounds/
    ├── piano/
    │   ├── C3.mp3 (50KB)
    │   ├── D3.mp3
    │   └── ... (各音程)
    ├── guitar/
    ├── drums/
    └── synth/
```

**メリット:**
- ✅ 完全無料
- ✅ Vercel CDN経由で高速配信
- ✅ 実装が簡単
- ✅ オフライン対応可能（PWA化時）

**デメリット:**
- ❌ リポジトリサイズが増加（20-50MB）
- ❌ デプロイ時間が長くなる
- ❌ 音源追加にデプロイが必要

**推奨サイズ:** 30MB以内
**適用フェーズ:** MVP

---

### 戦略B: Supabase Storage（無料プラン）

**構成:**
```
Supabase Storage Bucket: "sounds"
├── piano/
│   ├── C3.mp3
│   └── ...
└── guitar/
```

**メリット:**
- ✅ リポジトリが軽量
- ✅ 音源の追加・更新が容易
- ✅ 1GBまで無料

**デメリット:**
- ❌ 無料プランの制限: 2GB転送/月
- ❌ 初回ロードが遅い可能性
- ❌ 追加の設定が必要

**推奨サイズ:** 500MB以内
**適用フェーズ:** v1.5以降（ユーザー音源対応時）

---

### 戦略C: 外部CDN（Cloudflare R2など）

**メリット:**
- ✅ 大容量対応
- ✅ 高速配信
- ✅ コストが安い

**デメリット:**
- ❌ 追加コスト
- ❌ 設定が複雑

**コスト:** $0.015/GB（R2）
**適用フェーズ:** v2以降（スケール時）

---

### 戦略D: ハイブリッド配置（推奨）

**構成:**
- **基本音源（プリセット）**: リポジトリ内 (public/sounds/)
  - ファイルサイズ: 20-30MB
  - 8-10種類の楽器
  - MVP時点で実装

- **拡張音源**: Supabase Storage（将来）
  - ユーザーアップロード音源
  - 追加楽器パック
  - v2以降で実装

**メリット:**
- ✅ MVPは完全無料
- ✅ パフォーマンスとコストのバランス
- ✅ 将来の拡張性

**推奨度:** ★★★★★

---

## 4. ファイル形式と最適化

### ファイル形式の比較

| 形式 | 音質 | ファイルサイズ | ブラウザ対応 | 推奨度 |
|------|------|----------------|--------------|--------|
| **MP3** | ★★★☆☆ | 小（128kbps: 1MB/min） | 全ブラウザ対応 | ★★★★★ |
| **OGG** | ★★★★☆ | 小 | Chrome, Firefox | ★★★☆☆ |
| **WAV** | ★★★★★ | 大（10MB/min） | 全ブラウザ対応 | ★☆☆☆☆ |
| **AAC** | ★★★★☆ | 小 | 全ブラウザ対応 | ★★★☆☆ |
| **FLAC** | ★★★★★ | 中 | Chrome, Firefox | ★★☆☆☆ |

### 推奨設定: MP3

**理由:**
- 全ブラウザ対応
- ファイルサイズが小さい
- 十分な音質
- 実装が簡単

**推奨エンコード設定:**
- **ビットレート**: 128kbps（容量重視）〜 192kbps（品質重視）
- **サンプルレート**: 44.1kHz
- **チャンネル**: モノラル（楽器音は基本モノラル）

**ファイルサイズ目安:**
- 1秒の音: 16KB (128kbps)
- 1音程のサンプル: 10-50KB
- 1楽器（全音程）: 500KB - 2MB
- 8楽器: 4MB - 16MB

---

### サンプリング戦略

#### 戦略1: Full Sampling（全音程録音）
- C0, C#0, D0, ... C8 (全88音)
- ファイル数: 88個/楽器
- 音質: ★★★★★
- サイズ: 大

#### 戦略2: Multi Sampling（推奨）
- 2-3音程おきにサンプリング（C3, E3, G3, C4, ...）
- 中間音はピッチシフト
- ファイル数: 20-30個/楽器
- 音質: ★★★★☆
- サイズ: 中

#### 戦略3: Single Sampling
- 1音のみサンプリング（C4）
- 全音程をピッチシフト
- ファイル数: 1個/楽器
- 音質: ★★☆☆☆
- サイズ: 小

**推奨:** Multi Sampling（2-3音程おき）

---

## 5. 推奨案

### 【最推奨】案1: ハイブリッド方式 + Multi Sampling + リポジトリ配置

**音源構成:**

#### Phase 1 (MVP): シンプル構成
```
public/sounds/
├── piano/          # サンプル音源（Multi Sampling）
│   ├── C2.mp3
│   ├── E2.mp3
│   ├── G#2.mp3
│   ├── C3.mp3
│   ├── E3.mp3
│   ├── ... (20音程)
│
├── acoustic-guitar/ # サンプル音源
│   └── ... (15音程)
│
├── bass/           # サンプル音源
│   └── ... (12音程)
│
└── drums/          # サンプル音源（ドラムキット）
    ├── kick.mp3
    ├── snare.mp3
    ├── hihat.mp3
    └── ... (8種類)

+ Web Audio Oscillatorで
  - Synth Lead
  - Synth Pad
  - Synth Bass
  - Synth Pluck
```

**音源取得元:**
- **ピアノ**: Freesound.org または University of Iowa
- **ギター**: Philharmonia Orchestra（Acoustic Guitar）
- **ベース**: Freesound.org
- **ドラム**: Freesound.org（個別ドラムサンプル）
- **シンセ**: Web Audio API（コード実装）

**総ファイルサイズ:** 約25MB
**楽器数:** 8種類（サンプル4種 + シンセ4種）
**コスト:** 0円
**実装難易度:** ★★★☆☆

**メリット:**
- ✅ 完全無料
- ✅ 高速配信（Vercel CDN）
- ✅ リアルな音色とシンセの両立
- ✅ ファイルサイズが許容範囲

**デメリット:**
- ⚠️ 音源の選定・加工に時間がかかる
- ⚠️ ライセンス確認が必要

---

### 【次点】案2: SoundFont方式

**音源構成:**
```
public/soundfonts/
└── GeneralUser-GS.sf2  # 30MB
```

**実装:**
```javascript
import { SoundFont } from 'soundfont-player';

const sf = await SoundFont.instrument(audioContext, 'acoustic_grand_piano');
sf.play('C4', audioContext.currentTime, { duration: 1 });
```

**総ファイルサイズ:** 30MB（1ファイル）
**楽器数:** 128種類以上
**コスト:** 0円
**実装難易度:** ★★★★☆

**メリット:**
- ✅ 多様な楽器（128種以上）
- ✅ 1ファイルで完結
- ✅ 高品質

**デメリット:**
- ❌ JavaScriptライブラリの選択肢が少ない
- ❌ 初回ロードが重い（30MB）
- ❌ カスタマイズが困難

---

### 【シンプル】案3: 完全シンセ方式

**音源構成:**
- すべてWeb Audio API Oscillatorで実装

**実装:**
```javascript
// シンセエンジンを実装
class SimpleSynth {
  play(note, waveform = 'sine') {
    const osc = audioContext.createOscillator();
    osc.type = waveform;
    osc.frequency.value = this.noteToFreq(note);
    // ADSR Envelopeなどを実装
  }
}
```

**総ファイルサイズ:** 0MB
**楽器数:** 4-8種類（波形の組み合わせ）
**コスト:** 0円
**実装難易度:** ★★☆☆☆

**メリット:**
- ✅ 完全無料
- ✅ ファイルサイズゼロ
- ✅ レイテンシなし
- ✅ 実装が簡単

**デメリット:**
- ❌ リアルな楽器音が再現できない
- ❌ 表現力が限定的
- ❌ シンセサイザー音楽に限定

**適用:** プロトタイプ、チップチューン風アプリ

---

## 6. 具体的な実装ロードマップ

### Phase 1: MVP（2週間）
**目標:** 音が鳴るプロトタイプ

**実装内容:**
1. Web Audio API Oscillatorで4種類のシンセ音色
   - Sine（ピアノ風）
   - Triangle（リード風）
   - Sawtooth（ベース風）
   - Square（チップチューン風）

2. 簡易ADSRエンベロープ
3. 基本的な音程（C3-C5）

**音源データ:** 0MB
**実装時間:** 3-5日

---

### Phase 2: サンプル音源追加（1週間）
**目標:** リアルな音色を1つ追加

**実装内容:**
1. ピアノ音源の実装
   - Freesound.orgから音源収集
   - 20音程をMulti Sampling
   - Tone.js Samplerで実装

2. 音源の最適化
   - MP3エンコード（128kbps）
   - ファイルサイズ: 約2MB

**音源データ:** 2MB
**実装時間:** 3-5日

---

### Phase 3: 楽器の拡充（2週間）
**目標:** 8種類の楽器

**実装内容:**
1. サンプル音源: 3種類追加
   - アコースティックギター（3MB）
   - ベース（2MB）
   - ドラムキット（3MB）

2. シンセ音源: 3種類追加
   - Synth Pad（コード実装）
   - Synth Lead（コード実装）
   - Pluck Bass（コード実装）

**音源データ:** 約10MB
**実装時間:** 10日

---

### Phase 4: 音質向上（1週間）
**目標:** 音源の品質向上

**実装内容:**
1. ベロシティ対応
2. リバーブ・ディレイエフェクト
3. 音源のブラッシュアップ

**音源データ:** 約25MB（最終）
**実装時間:** 5日

---

## 7. 最終推奨決定

### 採用案: 【ハイブリッド方式】

**理由:**
1. **MVPは無料**: 完全無料でスタート可能
2. **段階的実装**: シンセから始めて、徐々にサンプル追加
3. **音質とサイズのバランス**: 25MBで8楽器は十分
4. **拡張性**: 将来Supabase Storageへ移行可能

**MVPの音源構成（最終形）:**
```
合計: 約25MB

サンプル音源:
- Piano (2MB, 20サンプル)
- Acoustic Guitar (3MB, 15サンプル)
- Bass (2MB, 12サンプル)
- Drums (3MB, 8キット)

シンセ音源（コード実装）:
- Synth Lead
- Synth Pad
- Synth Bass
- Synth Pluck
```

**音源取得元:**
- Freesound.org (CC0 or CC BY)
- Philharmonia Orchestra (CC BY-SA 3.0)
- University of Iowa (教育利用）

**配置:**
- public/sounds/ ディレクトリ
- Vercel CDN経由で配信

---

## 8. ライセンス管理

### 使用音源のライセンス表

音源を使用する際は、必ず以下の表を作成・管理します。

```markdown
## 使用音源ライセンス

| 楽器 | 音源名 | ライセンス | 出典 | 要クレジット |
|------|--------|------------|------|--------------|
| Piano | [音源名] | CC0 | Freesound.org | 不要 |
| Guitar | Acoustic Guitar Sample | CC BY-SA 3.0 | Philharmonia Orchestra | 必要 |
| ... | ... | ... | ... | ... |
```

### クレジット表記例（アプリ内）

```
## Credits

Sound samples:
- Piano: [Author Name] / Freesound.org / CC0
- Guitar: Philharmonia Orchestra / CC BY-SA 3.0
- Synthesizers: Web Audio API
```

---

## 9. 次のアクション

### 明日のタスク
- [ ] 音源戦略の最終決定（このドキュメントをレビュー）
- [ ] Phase 1の実装開始（Web Audio API シンセ）
- [ ] Tone.jsのセットアップ
- [ ] 音源ファイルの収集開始（Phase 2向け）

### 確認事項
- 音源の方向性（リアル重視 vs シンセ重視）
- ターゲットユーザーの好み
- ファイルサイズの許容範囲
- ライセンスの方針（商用利用の可否）

---

**このドキュメントに基づいて、明日詳細設計を行います。**
